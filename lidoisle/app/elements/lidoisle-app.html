<dom-module id="lidoisle-app">
  <template>
    <link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">
    <style include="shared-styles"></style>
    <paper-drawer-panel>
      <paper-scroll-header-panel drawer>
        <paper-toolbar id="drawerToolbar">
          <span class="paper-font-title">Menu</span>
        </paper-toolbar>
        <paper-menu class="list" attr-for-selected="data-route" selected="{{route}}" on-click="sendAjax"> 
        
          <a data-route="mypage" href="/app/mypage">
            <iron-icon icon="face"></iron-icon>
            <span>Mypage</span>
          </a>
        
          <a data-route="bought" href="/app/bought">
            <iron-icon icon="shopping-basket"></iron-icon>
            <span>Bought</span>
          </a>
        
        </paper-menu>
      </paper-scroll-header-panel>
      <paper-header-panel main>
        
        <paper-toolbar id="header">
          <h1>Maihama Lido Isle</h1>
          <p>Shopping experience makes you leap.</p>
        </paper-toolbar>
        
        <iron-pages attr-for-selected="data-route" selected="{{route}}">

          <section data-route="mypage">
            <h2 class="page-title">マイページ</h2>
            <template is="dom-repeat" items="{{page}}">
              <h1>{{item.productName}}</h1>
              <p>{{item.regularPrice}}</p>
            </template>
          </section>

          <section data-route="bought">
            <h2 class="page-title">買ったもの</h2>
            <p>{{page}</p>
          </section>

        </iron-pages>
      </paper-header-panel>
    </paper-drawer-panel> 
    
    <iron-ajax
      id="mypageAjax"
      url="http://localhost:8090/harbor/lido/mypage"
      with-credentials
      handle-as="json"
      on-response="handleResponse"
      on-error="handleError"></iron-ajax>
  </template>

  <script>
    (function() {
      'use strict';
      
      Polymer({
        is: 'lidoisle-app',
        properties: {
          route: {
            type: String
          },
          page: {
            type: Object
          }
        },
        sendAjax: function() {
          console.log(this.route);
          document.querySelector('#' + this.route + 'Ajax').generateRequest();
        },
        handleResponse: function() {
          this.page = document.querySelector('#' + this.route + 'Ajax').lastResponse;
          console.log(this.page);
        },
        ajaxError: function(e) {
          var toast = document.querySelector('#toast');
          toast.text = 'Invalid!'; 
          toast.show(); 
          console.log(e);
        }
      });
    })();
  </script>

</dom-module>
